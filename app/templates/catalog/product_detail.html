{% extends "base.html" %}

{% block title %}{{ product.nome }} - LojaVirtual{% endblock %}

{% block content %}
<div class="product-detail">
    <div class="product-detail-container">
        <div class="product-detail-image">
            {% if product.imagem %}
                <img src="{{ product.imagem }}" alt="{{ product.nome }}">
            {% else %}
                <div class="placeholder-image large">üì¶</div>
            {% endif %}
        </div>
        
        <div class="product-detail-info">
            <h1>{{ product.nome }}</h1>
            
            <div class="rating">
                <span class="stars">
                    {% if avg_rating %}
                        {{ "‚≠ê" * avg_rating }}
                    {% else %}
                        Sem avalia√ß√µes
                    {% endif %}
                </span>
                <span class="rating-value">{{ avg_rating }}/5</span>
            </div>
            
            <p class="description">{{ product.descricao }}</p>
            
            <div class="price-stock">
                <h2 class="price">R$ {{ "%.2f"|format(product.preco) }}</h2>
                <p class="stock">
                    {% if product.estoque > 0 %}
                        <span class="badge badge-success">{{ product.estoque }} em estoque</span>
                    {% else %}
                        <span class="badge badge-danger">Fora de Estoque</span>
                    {% endif %}
                </p>
            </div>
            
            {% if current_user.is_authenticated and product.estoque > 0 %}
                <form method="POST" action="{{ url_for('cart.add_item', product_id=product.id) }}" class="add-to-cart-form">
                    <div class="form-group">
                        <label for="quantidade">Quantidade:</label>
                        <input type="number" id="quantidade" name="quantidade" value="1" min="1" max="{{ product.estoque }}" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg">üõí Adicionar ao Carrinho</button>
                </form>
            {% elif not current_user.is_authenticated %}
                <p class="info">
                    <a href="{{ url_for('auth.login') }}" class="btn btn-primary btn-lg">Fa√ßa login para comprar</a>
                </p>
            {% endif %}
        </div>
    </div>
    
    <!-- Avalia√ß√µes -->
    <section class="reviews-section">
        <h2>Avalia√ß√µes dos Clientes</h2>
        
        {% if current_user.is_authenticated %}
            <div class="review-form">
                <h3>Deixe sua avalia√ß√£o</h3>
                <form method="POST" action="{{ url_for('review.add_review', product_id=product.id) }}">
                    <div class="form-group">
                        <label for="rating">Classifica√ß√£o:</label>
                        <select id="rating" name="rating" class="form-control" required>
                            <option value="">-- Selecione --</option>
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excelente</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Muito Bom</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê Bom</option>
                            <option value="2">‚≠ê‚≠ê Razo√°vel</option>
                            <option value="1">‚≠ê Ruim</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="comentario">Coment√°rio (opcional):</label>
                        <textarea id="comentario" name="comentario" class="form-control" rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Enviar Avalia√ß√£o</button>
                </form>
            </div>
        {% else %}
            <p><a href="{{ url_for('auth.login') }}">Fa√ßa login</a> para deixar uma avalia√ß√£o.</p>
        {% endif %}
        
        <div class="reviews-list">
            {% for review in reviews %}
                <div class="review-item">
                    <div class="review-header">
                        <span class="review-author">{{ review.usuario.nome }}</span>
                        <span class="review-rating">{{ "‚≠ê" * review.rating }}</span>
                    </div>
                    {% if review.comentario %}
                        <p class="review-comment">{{ review.comentario }}</p>
                    {% endif %}
                    <small class="review-date">{{ review.criado_em.strftime('%d/%m/%Y %H:%M') }}</small>
                </div>
            {% else %}
                <p class="no-reviews">Nenhuma avalia√ß√£o ainda. Seja o primeiro a avaliar!</p>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}
